<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <title>ChaiCode Storage</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap"
    rel="stylesheet"
  />
  <style>
    body {
      font-family: "JetBrains Mono", monospace;
      transition: background-color 0.3s, color 0.3s;
    }
  </style>
</head>
<body class="bg-[#0f0f0f] text-[#d9d9d9] min-h-screen flex flex-col transition-colors duration-300" data-theme="dark">
  <!-- Progress Bar Container -->
  <div id="progressContainer" class="fixed top-0 left-0 w-full h-1 bg-[#222222] z-50 hidden">
    <div id="progressBar" class="h-1 bg-[#0f9d58] w-0 transition-all duration-300"></div>
  </div>

  <!-- Header -->
  <header
    class="flex justify-between items-center px-6 py-3 bg-[#121212] flex-wrap gap-3 transition-colors duration-300"
    id="header"
  >
    <div class="flex items-center space-x-1 flex-shrink-0">
      <img
        alt="ChaiCode logo with a glass of chai"
        class="w-6 h-6"
        height="24"
        src="https://storage.googleapis.com/a1aa/image/c458b15d-1b7e-45a6-f03e-cc43d1a5e84b.jpg"
        width="24"
      />
      <span class="font-extrabold text-white text-lg select-none">ChaiCode</span>
      <span class="font-semibold text-[#d16f6f] text-lg select-none">Storage</span>
    </div>
    <div
      class="flex items-center space-x-3 bg-[#1a1a1a] rounded-md px-3 py-1 flex-shrink-0 transition-colors duration-300"
      id="headerRight"
    >
      <span
        class="flex items-center space-x-2 text-sm text-[#d9d9d9] select-none whitespace-nowrap"
      >
        <span class="w-2 h-2 rounded-full bg-[#2f9e44] block"></span>
        <span>sinznbucket2026</span>
      </span>
      <button
        id="disconnectBtn"
        class="flex items-center space-x-1 bg-[#d9534f] hover:bg-[#c9302c] text-white text-xs font-semibold px-3 py-1 rounded-md"
        type="button"
      >
        <i class="fas fa-times"></i>
        <span>Disconnect</span>
      </button>
      <button
        id="themeToggleBtn"
        class="flex items-center space-x-1 bg-[#444444] hover:bg-[#666666] text-white text-xs font-semibold px-3 py-1 rounded-md"
        type="button"
        aria-label="Toggle dark and light mode"
        title="Toggle dark and light mode"
      >
        <i class="fas fa-adjust"></i>
        <span>Toggle Theme</span>
      </button>
    </div>
  </header>

  <!-- Main container -->
  <main class="flex-grow flex justify-center items-start p-6 transition-colors duration-300" id="mainContainer">
    <section
      aria-label="File storage container"
      class="w-full max-w-5xl bg-[#121212] rounded-xl overflow-hidden transition-colors duration-300"
      id="storageSection"
    >
      <!-- Path, Back button and New Folder -->
      <div
        class="flex justify-between items-center border-b border-[#222222] px-4 py-2 text-sm select-none flex-wrap gap-2"
      >
        <div class="flex items-center space-x-2 flex-wrap">
          <button
            id="backBtn"
            class="flex items-center space-x-1 bg-[#444444] hover:bg-[#666666] text-white text-xs font-semibold px-3 py-1 rounded-md disabled:opacity-50 disabled:cursor-not-allowed"
            type="button"
            disabled
            aria-label="Go back to previous folder"
          >
            <i class="fas fa-arrow-left"></i>
            <span>Back</span>
          </button>
          <nav aria-label="Breadcrumb" class="flex items-center space-x-1 flex-wrap">
            <button
              id="breadcrumbRoot"
              class="text-[#d9d9d9] hover:underline focus:outline-none"
              type="button"
              aria-current="page"
            >
              /
            </button>
            <span id="breadcrumbPath" class="flex space-x-1 text-[#d16f6f] font-semibold"></span>
          </nav>
        </div>
        <div class="flex space-x-2 flex-wrap">
          <button
            id="newFolderBtn"
            class="flex items-center space-x-1 bg-[#0f9d58] hover:bg-[#0b7d43] text-white text-xs font-semibold px-3 py-1 rounded-md"
            type="button"
          >
            <i class="fas fa-folder-plus"></i>
            <span>New Folder</span>
          </button>
          <button
            id="deleteBtn"
            class="flex items-center space-x-1 bg-[#d9534f] hover:bg-[#c9302c] text-white text-xs font-semibold px-3 py-1 rounded-md disabled:opacity-50 disabled:cursor-not-allowed"
            type="button"
            disabled
          >
            <i class="fas fa-trash-alt"></i>
            <span>Delete</span>
          </button>
        </div>
      </div>

      <!-- Search and Filter -->
      <div
        class="flex justify-between items-center border-b border-[#222222] px-4 py-3 flex-wrap gap-3"
      >
        <input
          id="searchInput"
          aria-label="Search files and folders"
          class="bg-[#121212] border border-[#222222] rounded-md text-xs text-[#d9d9d9] placeholder:text-[#666666] px-3 py-1 w-full sm:w-60 focus:outline-none focus:ring-1 focus:ring-[#0f9d58] transition-colors duration-300"
          placeholder="Search files and folders..."
          type="search"
        />
        <div class="relative inline-block text-left">
          <button
            id="filterBtn"
            class="flex items-center space-x-1 bg-[#1a1a1a] hover:bg-[#222222] text-[#d9d9d9] text-xs font-semibold px-3 py-1 rounded-md border border-[#222222]"
            type="button"
            aria-haspopup="true"
            aria-expanded="false"
          >
            <i class="fas fa-filter"></i>
            <span>Filter</span>
            <i class="fas fa-caret-down ml-1"></i>
          </button>
          <div
            id="filterMenu"
            class="hidden origin-top-right absolute right-0 mt-2 w-40 rounded-md shadow-lg bg-[#121212] ring-1 ring-black ring-opacity-5 focus:outline-none z-50"
            role="menu"
            aria-orientation="vertical"
            aria-labelledby="filterBtn"
            tabindex="-1"
          >
            <div class="py-1" role="none">
              <button class="filter-option block w-full text-left px-4 py-2 text-xs text-[#d9d9d9] hover:bg-[#222222] hover:text-[#0f9d58]" data-filter="all" role="menuitem" tabindex="-1">All</button>
              <button class="filter-option block w-full text-left px-4 py-2 text-xs text-[#d9d9d9] hover:bg-[#222222] hover:text-[#0f9d58]" data-filter="folder" role="menuitem" tabindex="-1">Folder</button>
              <button class="filter-option block w-full text-left px-4 py-2 text-xs text-[#d9d9d9] hover:bg-[#222222] hover:text-[#0f9d58]" data-filter="IMAGE" role="menuitem" tabindex="-1">Image</button>
              <button class="filter-option block w-full text-left px-4 py-2 text-xs text-[#d9d9d9] hover:bg-[#222222] hover:text-[#0f9d58]" data-filter="DOCUMENT" role="menuitem" tabindex="-1">Document</button>
              <button class="filter-option block w-full text-left px-4 py-2 text-xs text-[#d9d9d9] hover:bg-[#222222] hover:text-[#0f9d58]" data-filter="video" role="menuitem" tabindex="-1">Video</button>
              <button class="filter-option block w-full text-left px-4 py-2 text-xs text-[#d9d9d9] hover:bg-[#222222] hover:text-[#0f9d58]" data-filter="other" role="menuitem" tabindex="-1">Other</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Drop files area -->
      <div
        id="dropArea"
        aria-label="Drop files or click to upload"
        class="m-4 border-2 border-dashed border-[#222222] rounded-md text-center text-xs font-semibold text-[#d9d9d9] py-4 select-none cursor-pointer transition-colors duration-300"
        role="button"
        tabindex="0"
      >
        <i class="fas fa-upload mr-1"></i>
        <span>Drop files or click to upload</span>
        <input
          type="file"
          id="fileInput"
          multiple
          class="hidden"
          aria-hidden="true"
        />
      </div>

      <!-- Select All -->
      <div
        class="px-6 py-2 border-b border-[#222222] text-xs text-[#666666] select-none transition-colors duration-300"
      >
        <label class="inline-flex items-center space-x-2 cursor-pointer">
          <input
            id="selectAllCheckbox"
            aria-label="Select All files and folders"
            class="form-checkbox rounded border-[#222222] bg-[#121212] text-[#f59e0b]"
            type="checkbox"
          />
          <span id="selectAllLabel">Select All (0 items)</span>
        </label>
      </div>

      <!-- File list -->
      <ul id="fileList" class="divide-y divide-[#222222] transition-colors duration-300"></ul>
    </section>
  </main>

  <script>
    // Data structure for files and folders with nested children
    let root = {
      id: "root",
      type: "folder",
      name: "/",
      children: [
        {
          id: 1,
          type: "folder",
          name: "Extra_content",
          color: "#f59e0b",
          children: [],
        },
        {
          id: 2,
          type: "folder",
          name: "Terraform_by_hitesh_sir",
          color: "#f59e0b",
          children: [],
        },
        {
          id: 3,
          type: "folder",
          name: "Terraform_video",
          color: "#f59e0b",
          children: [],
        },
        {
          id: 4,
          type: "file",
          name: "DEV.pdf",
          category: "DOCUMENT",
          size: "17 KB",
        },
        {
          id: 5,
          type: "file",
          name: "Screenshot 2025-06-30 160111.png",
          category: "IMAGE",
          size: "228 KB",
        },
      ],
    };

    // Current folder pointer (start at root)
    let currentFolder = root;
    // Stack to track navigation path (excluding root)
    let pathStack = [];

    // Current filter type: "all", "folder", "IMAGE", "DOCUMENT", "video", "other"
    let currentFilter = "all";

    const fileListEl = document.getElementById("fileList");
    const selectAllCheckbox = document.getElementById("selectAllCheckbox");
    const selectAllLabel = document.getElementById("selectAllLabel");
    const searchInput = document.getElementById("searchInput");
    const dropArea = document.getElementById("dropArea");
    const fileInput = document.getElementById("fileInput");
    const newFolderBtn = document.getElementById("newFolderBtn");
    const disconnectBtn = document.getElementById("disconnectBtn");
    const deleteBtn = document.getElementById("deleteBtn");
    const breadcrumbPath = document.getElementById("breadcrumbPath");
    const breadcrumbRoot = document.getElementById("breadcrumbRoot");
    const backBtn = document.getElementById("backBtn");
    const filterBtn = document.getElementById("filterBtn");
    const filterMenu = document.getElementById("filterMenu");
    const progressContainer = document.getElementById("progressContainer");
    const progressBar = document.getElementById("progressBar");
    const themeToggleBtn = document.getElementById("themeToggleBtn");
    const body = document.body;
    const header = document.getElementById("header");
    const headerRight = document.getElementById("headerRight");
    const mainContainer = document.getElementById("mainContainer");
    const storageSection = document.getElementById("storageSection");

    // Track selected files by id
    let selectedIds = new Set();

    // Generate unique IDs for new items
    function generateId() {
      return Date.now() + Math.random();
    }

    // Show progress bar with percentage
    function showProgress(percent) {
      progressContainer.style.display = "block";
      progressBar.style.width = percent + "%";
      if (percent >= 100) {
        setTimeout(() => {
          progressContainer.style.display = "none";
          progressBar.style.width = "0%";
        }, 500);
      }
    }

    // Render breadcrumb navigation
    function renderBreadcrumb() {
      breadcrumbPath.innerHTML = "";
      pathStack.forEach((folder, index) => {
        const btn = document.createElement("button");
        btn.type = "button";
        btn.className =
          "hover:underline focus:outline-none text-[#d16f6f] font-semibold";
        btn.textContent = folder.name;
        btn.addEventListener("click", () => {
          // Navigate to clicked folder in breadcrumb
          pathStack = pathStack.slice(0, index + 1);
          currentFolder = folder;
          selectedIds.clear();
          renderFileList();
          renderBreadcrumb();
          updateBackButton();
        });
        breadcrumbPath.appendChild(document.createTextNode(" / "));
        breadcrumbPath.appendChild(btn);
      });
    }

    // Navigate to root folder
    breadcrumbRoot.addEventListener("click", () => {
      currentFolder = root;
      pathStack = [];
      selectedIds.clear();
      renderFileList();
      renderBreadcrumb();
      updateBackButton();
    });

    // Filter files by currentFilter
    function filterByType(file) {
      if (currentFilter === "all") return true;
      if (currentFilter === "folder") return file.type === "folder";
      if (currentFilter === "video") {
        // For demo, treat files with video extensions as video
        if (file.type !== "file") return false;
        const videoExts = ["mp4", "avi", "mov", "wmv", "flv", "mkv"];
        const ext = file.name.split(".").pop().toLowerCase();
        return videoExts.includes(ext);
      }
      if (currentFilter === "other") {
        if (file.type === "folder") return false;
        if (file.category !== "IMAGE" && file.category !== "DOCUMENT") {
          // Also exclude video files
          const videoExts = ["mp4", "avi", "mov", "wmv", "flv", "mkv"];
          const ext = file.name.split(".").pop().toLowerCase();
          if (!videoExts.includes(ext)) return true;
        }
        return false;
      }
      return file.category === currentFilter;
    }

    // Render file list based on current folder, search filter, and type filter
    function renderFileList() {
      const filterText = searchInput.value.toLowerCase();
      const filteredFiles = currentFolder.children.filter(
        (file) =>
          file.name.toLowerCase().includes(filterText) && filterByType(file)
      );

      fileListEl.innerHTML = "";

      filteredFiles.forEach((file) => {
        const li = document.createElement("li");
        li.className =
          "flex items-center space-x-3 px-6 py-3 justify-between text-xs select-text flex-wrap sm:flex-nowrap";

        // Left side: checkbox, icon, name
        const leftDiv = document.createElement("div");
        leftDiv.className = "flex items-center space-x-3 flex-shrink-0";

        const label = document.createElement("label");
        label.className = "inline-flex items-center space-x-2 cursor-pointer";

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.className =
          "form-checkbox rounded border-[#222222] bg-[#121212] text-[#f59e0b]";
        checkbox.setAttribute("aria-label", `Select ${file.name} ${file.type}`);
        checkbox.checked = selectedIds.has(file.id);
        checkbox.addEventListener("change", () => {
          if (checkbox.checked) {
            selectedIds.add(file.id);
          } else {
            selectedIds.delete(file.id);
          }
          updateSelectAllCheckbox();
          updateDeleteButton();
        });

        label.appendChild(checkbox);

        const icon = document.createElement("i");
        if (file.type === "folder") {
          icon.className = "fas fa-folder cursor-pointer";
          icon.style.color = file.color || "#f59e0b";
          icon.title = "Click to open folder";
          icon.tabIndex = 0;
          icon.setAttribute("role", "button");
          icon.setAttribute("aria-label", `Open folder ${file.name}`);
          icon.addEventListener("click", () => {
            openFolder(file);
          });
          icon.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              openFolder(file);
            }
          });
        } else {
          icon.className = "fas fa-file-alt text-[#d9d9d9]";
        }
        label.appendChild(icon);

        const nameSpan = document.createElement("span");
        nameSpan.className =
          file.type === "folder"
            ? "text-[#f59e0b] font-semibold text-xs select-text cursor-pointer"
            : "font-semibold text-white";
        nameSpan.textContent = file.name;
        if (file.type === "folder") {
          nameSpan.title = "Click to open folder";
          nameSpan.tabIndex = 0;
          nameSpan.setAttribute("role", "button");
          nameSpan.setAttribute("aria-label", `Open folder ${file.name}`);
          nameSpan.addEventListener("click", () => {
            openFolder(file);
          });
          nameSpan.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              openFolder(file);
            }
          });
        }
        label.appendChild(nameSpan);

        leftDiv.appendChild(label);
        li.appendChild(leftDiv);

        // Right side: category, size, preview, download (only for files)
        if (file.type === "file") {
          const rightDiv = document.createElement("div");
          rightDiv.className = "flex items-center space-x-4 flex-shrink-0";

          const categorySpan = document.createElement("span");
          categorySpan.className =
            "bg-[#2a2a2a] text-[#666666] uppercase rounded px-2 py-0.5 select-none";
          categorySpan.textContent = file.category;
          rightDiv.appendChild(categorySpan);

          const sizeSpan = document.createElement("span");
          sizeSpan.className = "text-[#999999] select-none";
          sizeSpan.textContent = file.size;
          rightDiv.appendChild(sizeSpan);

          const previewBtn = document.createElement("button");
          previewBtn.className = "text-[#f59e0b] hover:text-[#d18b00]";
          previewBtn.type = "button";
          previewBtn.setAttribute("aria-label", `Preview ${file.name}`);
          previewBtn.innerHTML = '<i class="fas fa-eye"></i>';
          previewBtn.addEventListener("click", () => {
            showProgressSimulated(`Previewing file: ${file.name}`);
          });
          rightDiv.appendChild(previewBtn);

          const downloadBtn = document.createElement("button");
          downloadBtn.className = "text-[#f59e0b] hover:text-[#d18b00]";
          downloadBtn.type = "button";
          downloadBtn.setAttribute("aria-label", `Download ${file.name}`);
          downloadBtn.innerHTML = '<i class="fas fa-download"></i>';
          downloadBtn.addEventListener("click", () => {
            showProgressSimulated(`Downloading file: ${file.name}`);
          });
          rightDiv.appendChild(downloadBtn);

          li.appendChild(rightDiv);
        }

        fileListEl.appendChild(li);
      });

      updateSelectAllLabel(filteredFiles.length);
      updateSelectAllCheckbox();
      updateDeleteButton();
      updateBackButton();
    }

    // Open folder and update path
    function openFolder(folder) {
      currentFolder = folder;
      pathStack.push(folder);
      selectedIds.clear();
      renderFileList();
      renderBreadcrumb();
      updateBackButton();
    }

    // Update the "Select All" label count
    function updateSelectAllLabel(count) {
      selectAllLabel.textContent = `Select All (${count} item${count !== 1 ? "s" : ""})`;
    }

    // Update the "Select All" checkbox state
    function updateSelectAllCheckbox() {
      const filterText = searchInput.value.toLowerCase();
      const filteredFiles = currentFolder.children.filter(
        (file) =>
          file.name.toLowerCase().includes(filterText) && filterByType(file)
      );
      const allSelected =
        filteredFiles.length > 0 &&
        filteredFiles.every((file) => selectedIds.has(file.id));
      const someSelected = filteredFiles.some((file) => selectedIds.has(file.id));
      selectAllCheckbox.checked = allSelected;
      selectAllCheckbox.indeterminate = !allSelected && someSelected;
    }

    // Update delete button enabled state
    function updateDeleteButton() {
      deleteBtn.disabled = selectedIds.size === 0;
    }

    // Update back button enabled state
    function updateBackButton() {
      backBtn.disabled = pathStack.length === 0;
    }

    // Handle Select All checkbox change
    selectAllCheckbox.addEventListener("change", () => {
      const filterText = searchInput.value.toLowerCase();
      const filteredFiles = currentFolder.children.filter(
        (file) =>
          file.name.toLowerCase().includes(filterText) && filterByType(file)
      );
      if (selectAllCheckbox.checked) {
        filteredFiles.forEach((file) => selectedIds.add(file.id));
      } else {
        filteredFiles.forEach((file) => selectedIds.delete(file.id));
      }
      renderFileList();
      updateDeleteButton();
    });

    // Handle search input
    searchInput.addEventListener("input", () => {
      renderFileList();
    });

    // Handle drop area click to open file dialog
    dropArea.addEventListener("click", () => {
      fileInput.click();
    });

    // Handle keyboard accessibility for drop area (Enter or Space)
    dropArea.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        fileInput.click();
      }
    });

    // Simulate progress bar for preview/download actions
    function showProgressSimulated(actionText) {
      let progress = 0;
      showProgress(progress);
      const interval = setInterval(() => {
        progress += Math.random() * 20 + 10; // increment randomly 10-30%
        if (progress >= 100) {
          progress = 100;
          showProgress(progress);
          clearInterval(interval);
          setTimeout(() => {
            progressContainer.style.display = "none";
            progressBar.style.width = "0%";
            alert(actionText + " completed.");
          }, 500);
        } else {
          showProgress(progress);
        }
      }, 300);
    }

    // Handle file input change (upload files) with progress simulation
    fileInput.addEventListener("change", (e) => {
      const newFiles = Array.from(e.target.files);
      if (newFiles.length === 0) return;
      let totalFiles = newFiles.length;
      let uploadedFiles = 0;

      showProgress(0);

      function uploadNext() {
        if (uploadedFiles >= totalFiles) {
          setTimeout(() => {
            progressContainer.style.display = "none";
            progressBar.style.width = "0%";
            renderFileList();
          }, 500);
          return;
        }
        // Simulate upload progress for each file
        let progress = 0;
        const file = newFiles[uploadedFiles];
        const id = generateId();
        const ext = file.name.split(".").pop().toLowerCase();
        let category = "FILE";
        if (["png", "jpg", "jpeg", "gif", "bmp", "svg"].includes(ext)) {
          category = "IMAGE";
        } else if (["pdf", "doc", "docx", "txt", "md"].includes(ext)) {
          category = "DOCUMENT";
        } else if (["mp4", "avi", "mov", "wmv", "flv", "mkv"].includes(ext)) {
          category = "VIDEO";
        }
        const interval = setInterval(() => {
          progress += Math.random() * 20 + 10;
          if (progress >= 100) {
            progress = 100;
            currentFolder.children.push({
              id,
              type: "file",
              name: file.name,
              category,
              size: formatFileSize(file.size),
            });
            showProgress((uploadedFiles + 1) / totalFiles * 100);
            clearInterval(interval);
            uploadedFiles++;
            uploadNext();
          } else {
            showProgress(((uploadedFiles + progress / 100) / totalFiles) * 100);
          }
        }, 200);
      }
      fileInput.value = "";
      uploadNext();
    });

    // Format file size in bytes to KB, MB, etc.
    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + " B";
      else if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(0) + " KB";
      else if (bytes < 1024 * 1024 * 1024)
        return (bytes / (1024 * 1024)).toFixed(1) + " MB";
      else return (bytes / (1024 * 1024 * 1024)).toFixed(1) + " GB";
    }

    // Handle new folder creation
    newFolderBtn.addEventListener("click", () => {
      let folderName = prompt("Enter new folder name:");
      if (folderName) {
        folderName = folderName.trim();
        if (folderName.length === 0) {
          alert("Folder name cannot be empty.");
          return;
        }
        // Check for duplicate folder name in current folder
        const exists = currentFolder.children.some(
          (f) => f.type === "folder" && f.name.toLowerCase() === folderName.toLowerCase()
        );
        if (exists) {
          alert("Folder with this name already exists.");
          return;
        }
        const id = generateId();
        currentFolder.children.push({
          id,
          type: "folder",
          name: folderName,
          color: "#f59e0b",
          children: [],
        });
        renderFileList();
      }
    });

    // Handle disconnect button click
    disconnectBtn.addEventListener("click", () => {
      if (confirm("Are you sure you want to disconnect?")) {
        alert("Disconnected.");
        // Here you can add actual disconnect logic if needed
      }
    });

    // Handle delete button click
    deleteBtn.addEventListener("click", () => {
      if (selectedIds.size === 0) return;
      if (!confirm(`Are you sure you want to delete ${selectedIds.size} item(s)?`))
        return;

      // Remove selected items from current folder
      currentFolder.children = currentFolder.children.filter(
        (item) => !selectedIds.has(item.id)
      );
      selectedIds.clear();
      renderFileList();
      updateDeleteButton();
    });

    // Handle back button click
    backBtn.addEventListener("click", () => {
      if (pathStack.length === 0) return;
      pathStack.pop();
      currentFolder = pathStack.length === 0 ? root : pathStack[pathStack.length - 1];
      selectedIds.clear();
      renderFileList();
      renderBreadcrumb();
      updateBackButton();
    });

    // Drag and drop file upload support
    dropArea.addEventListener("dragover", (e) => {
      e.preventDefault();
      dropArea.classList.add("border-[#0f9d58]");
      dropArea.classList.add("text-[#0f9d58]");
    });

    dropArea.addEventListener("dragleave", (e) => {
      e.preventDefault();
      dropArea.classList.remove("border-[#0f9d58]");
      dropArea.classList.remove("text-[#0f9d58]");
    });

    dropArea.addEventListener("drop", (e) => {
      e.preventDefault();
      dropArea.classList.remove("border-[#0f9d58]");
      dropArea.classList.remove("text-[#0f9d58]");
      const droppedFiles = Array.from(e.dataTransfer.files);
      if (droppedFiles.length > 0) {
        let totalFiles = droppedFiles.length;
        let uploadedFiles = 0;

        showProgress(0);

        function uploadNext() {
          if (uploadedFiles >= totalFiles) {
            setTimeout(() => {
              progressContainer.style.display = "none";
              progressBar.style.width = "0%";
              renderFileList();
            }, 500);
            return;
          }
          // Simulate upload progress for each file
          let progress = 0;
          const file = droppedFiles[uploadedFiles];
          const id = generateId();
          const ext = file.name.split(".").pop().toLowerCase();
          let category = "FILE";
          if (["png", "jpg", "jpeg", "gif", "bmp", "svg"].includes(ext)) {
            category = "IMAGE";
          } else if (["pdf", "doc", "docx", "txt", "md"].includes(ext)) {
            category = "DOCUMENT";
          } else if (["mp4", "avi", "mov", "wmv", "flv", "mkv"].includes(ext)) {
            category = "VIDEO";
          }
          const interval = setInterval(() => {
            progress += Math.random() * 20 + 10;
            if (progress >= 100) {
              progress = 100;
              currentFolder.children.push({
                id,
                type: "file",
                name: file.name,
                category,
                size: formatFileSize(file.size),
              });
              showProgress(((uploadedFiles + 1) / totalFiles) * 100);
              clearInterval(interval);
              uploadedFiles++;
              uploadNext();
            } else {
              showProgress(((uploadedFiles + progress / 100) / totalFiles) * 100);
            }
          }, 200);
        }
        uploadNext();
      }
    });

    // Filter menu toggle
    filterBtn.addEventListener("click", () => {
      const isHidden = filterMenu.classList.contains("hidden");
      if (isHidden) {
        filterMenu.classList.remove("hidden");
        filterBtn.setAttribute("aria-expanded", "true");
      } else {
        filterMenu.classList.add("hidden");
        filterBtn.setAttribute("aria-expanded", "false");
      }
    });

    // Close filter menu on outside click
    document.addEventListener("click", (e) => {
      if (!filterBtn.contains(e.target) && !filterMenu.contains(e.target)) {
        filterMenu.classList.add("hidden");
        filterBtn.setAttribute("aria-expanded", "false");
      }
    });

    // Filter option click
    document.querySelectorAll(".filter-option").forEach((btn) => {
      btn.addEventListener("click", () => {
        currentFilter = btn.getAttribute("data-filter");
        filterMenu.classList.add("hidden");
        filterBtn.setAttribute("aria-expanded", "false");
        renderFileList();
      });
    });

    // Toggle dark/light theme
    themeToggleBtn.addEventListener("click", () => {
      if (body.getAttribute("data-theme") === "dark") {
        body.setAttribute("data-theme", "light");
        body.classList.remove("bg-[#0f0f0f]", "text-[#d9d9d9]");
        body.classList.add("bg-white", "text-black");
        header.classList.remove("bg-[#121212]");
        header.classList.add("bg-gray-100");
        headerRight.classList.remove("bg-[#1a1a1a]");
        headerRight.classList.add("bg-gray-200");
        mainContainer.classList.remove("bg-[#0f0f0f]");
        mainContainer.classList.add("bg-gray-50");
        storageSection.classList.remove("bg-[#121212]");
        storageSection.classList.add("bg-white");
      } else {
        body.setAttribute("data-theme", "dark");
        body.classList.remove("bg-white", "text-black");
        body.classList.add("bg-[#0f0f0f]", "text-[#d9d9d9]");
        header.classList.remove("bg-gray-100");
        header.classList.add("bg-[#121212]");
        headerRight.classList.remove("bg-gray-200");
        headerRight.classList.add("bg-[#1a1a1a]");
        mainContainer.classList.remove("bg-gray-50");
        mainContainer.classList.add("bg-[#0f0f0f]");
        storageSection.classList.remove("bg-white");
        storageSection.classList.add("bg-[#121212]");
      }
    });

    // Initial render
    renderFileList();
    renderBreadcrumb();
    updateDeleteButton();
    updateBackButton();
  </script>
</body>
</html>
